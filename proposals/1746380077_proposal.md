# Improvement Proposal

## Title: Enhance `/status` endpoint for UI visibility

## Description:

This pull request implements the Founder AI's proposal to improve user experience by enhancing the `/status` endpoint in the FastAPI application. This will allow users to monitor the progress of the improvement cycle more effectively.
Changes to be made:
-   **Implement `/status` Endpoint:** Add a new `/status` endpoint to the FastAPI application in `main.py`. This endpoint will return a JSON payload containing the current state of the improvement cycle, using the `cycle_data` from the `Observability` class.
-   **Enhance `Observability` Class:** Modify the `Observability` class in `src/observability.py` to store and provide more detailed information about each stage of the improvement cycle. This includes timestamps (start and end), the proposal title and description, the pull request URL, and any errors encountered.
-   **Integrate with Logging System:** Ensure all relevant events (start/end of stages, errors, etc.) are logged using the Python `logging` module within the `Observability` class. This will provide consistency between the `/status` endpoint and the logs.
-   **Data Serialization:** Ensure that data returned by the `/status` endpoint can be serialized to JSON.
-   **Error Handling**: Add error handling for edge cases like missing proposal information, etc.
-   **Security**: Ensure that the `/status` endpoint does not expose sensitive information. Any sensitive information contained in the `cycle_data` must be sanitized or redacted before exposure in the `/status` endpoint.
Why these changes are beneficial:
-   Improved User Experience: Provides users with a real-time view of the system's progress, making it easier to monitor and understand the automated improvement cycle.
-   Enhanced Monitoring: Offers a centralized location for monitoring cycle status.
-   Simplified Debugging: The integrated logging, coupled with the `/status` endpoint, facilitates easier debugging and identification of issues.
Potential impacts:
-   Slight Overhead: There might be a minimal performance overhead due to the extra data aggregation and serialization for the `/status` HTTP response.
-   Complexity: Requires careful integration of the `Observability` class and data serialization.
-   Security Risks: Potential for exposing sensitive data in the `/status` response.
Testing that will be done:
-   **Unit Tests:**
-   Verify that the `/status` endpoint returns a 200 OK response.
-   Verify that the JSON payload returned by the `/status` endpoint contains the correct keys and data types, including timestamps, proposal details, and error information (if any).
-   Test different states of the improvement cycle to ensure all data is correctly reflected in the `/status` output.
-   Verify that sensitive data is not exposed via the `/status` endpoint.
-   **Integration Tests:**
-   Verify that the information displayed on the `/status` endpoint aligns with the information captured by the logs.
-   Test the full improvement cycle workflow and monitor the data in `/status` endpoint.
-   **Manual Testing:**
-   Test the `/status` endpoint during normal operation to verify correct data representation.

## Files to Change:
- src/main.py
- src/observability.py
- tests/test_main.py
- tests/test_observability.py

## Original Proposal from Founder:
Okay, I will focus on improving the "User Experience" and specifically the visibility of the system's progress. Based on the file summaries, the system currently relies heavily on logging. However, simply logging information to a file doesn't provide a good user experience.

Here's my analysis and proposal:

1.  **Analysis of Current State**

    *   The system relies on logging for tracking progress and results.  The `Observability` class in `src/observability.py` seems to be the primary mechanism for this.
    *   The logs are likely written to files (as indicated by the use of logging in various files and the `_get_log_filename` function within `Observability`).
    *   There is no immediate way for a user to get a high-level overview of the system's current state, the ongoing cycle's progress, or the results without manually examining log files. This makes it difficult to monitor the system's progress.
    *   The `main.py` file, which runs the core loop, may or may not have direct output to the console.
    *   The FastAPI web application could be leveraged to provide a better user interface.

2.  **Proposed Improvement**

    *   **Integrate the `Observability` data into the FastAPI Application:** Modify the `main.py` file to expose a `/status` endpoint in the FastAPI application. This endpoint will return a JSON representation of the current improvement cycle's status and the data collected by the `Observability` class.
    *   **Add More Informative Data to Observability:** Enhance the `Observability` class to store and provide more information about each stage of the improvement cycle. Include details like:
        *   Start and end timestamps for each step (analysis, proposal, implementation, PR creation).
        *   The proposal title and description generated by the Founder AI.
        *   The pull request URL (if one was created).
        *   Any errors that occurred during any stage.
    *   **Integrate with the Logging System:** Ensure that all relevant events (start/end of stages, errors, etc.) are logged using the standard Python `logging` module within the `Observability` class, or at least that there is a connection between them.

3.  **Priority level (2)**

    *   This improvement directly addresses user experience.
    *   The effort is relatively low. The main changes are adding an endpoint and returning the existing `cycle_data`.

4.  **Success Criteria**

    *   A `/status` endpoint is available in the FastAPI application.
    *   The `/status` endpoint returns a JSON payload containing the current cycle's state, timestamps, proposal information, and any errors.
    *   The information displayed in `/status` aligns with the data being captured by the `Observability` class and provides a coherent view of the improvement cycle's progress.
    *   The logs contain all the information from the `/status` endpoint and any other error messages.

5.  **Potential Risks**

    *   **Overhead:** Adding this functionality introduces a slight overhead to the execution of the improvement cycle due to the extra data aggregation and serialization for the HTTP response.
    *   **Complexity:** While the current system is not too complex, there's a slight risk of introducing errors if the `Observability` class is not properly integrated and data is not collected and displayed correctly.
    *   **Security:** If the `/status` endpoint exposes sensitive information (e.g., API keys in error messages) without proper redaction or sanitization. This risk will need to be assessed before launch.

