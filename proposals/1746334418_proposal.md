# Improvement Proposal

## Title: Enhance UX with Progress Logging & Cycle ID

## Description:

This pull request focuses on improving the user experience by providing clear progress indication during the improvement cycle. Currently, users receive minimal feedback on the cycle's progress. This change addresses this by:
*   **Integrating and Activating `src/observability.py`:** The `Observability` class, designed for tracking cycle phases, will be instantiated and utilized within the `SystemOrchestrator`. This will allow for logging of each phase.
*   **Enhancing Logging in `src/orchestrator.py`:** The logging messages in the orchestrator will be modified to leverage the `Observability` methods to provide descriptive feedback on each step. Cycle ID will also be added to each log.
*   **Enhancing Logging in Agent files:** Added logging to the AI agent files (`src/agents/base.py`, `src/agents/founder.py`, `src/agents/developer.py`, `src/agents/code_reader.py`) to log their steps.
*   **Modifying `/improve` Endpoint in `src/main.py`:** The `/improve` endpoint will be updated to return a success message, including a unique cycle ID generated from the current timestamp.
**Why these changes are beneficial:**
*   **Improved User Experience:** Provides users with a clear understanding of the improvement cycle's progress, enhancing usability.
*   **Enhanced Debugging:** Facilitates debugging by providing detailed logs of each step and any errors encountered.
*   **Increased Transparency:** Offers better visibility into the system's operations.
**Potential Impacts:**
*   **Increased Log Volume:** Could potentially increase the volume of logged information, requiring careful management.
*   **Slight Performance Overhead:** The `Observability` module integration and additional logging could introduce a small performance overhead. This will be monitored and optimized if necessary.
**Testing Approach:**
*   **Unit Tests (If applicable):** No unit tests are needed for now, since no new functionality is introduced.
*   **Functional Testing:**
*   Call the `/improve` endpoint and verify that a cycle ID is returned in the response.
*   Verify that the console output (or the service's logging output) displays the expected log messages for each step of the improvement cycle, including the cycle ID.
*   Verify that the log messages are descriptive and easy to understand.
*   Check for error messages and ensure they contain the cycle ID.
*   Verify the correct use of the cycle ID when an exception is thrown in any cycle step.
ROLLBACK PLAN:
*   If any issue, simply revert the changes to the listed files.

## Files to Change:
- `src/orchestrator.py`
- `src/main.py`
- `src/agents/base.py`
- `src/agents/founder.py`
- `src/agents/developer.py`
- `src/agents/code_reader.py`

## Original Proposal from Founder:
Okay, I will focus on improving the **user experience** of the system by addressing the lack of clear progress indication during the improvement cycle. Currently, the system runs in the background, and a user has no immediate feedback on its progress. This can be improved by providing more visible logging and progress reporting.

1.  **Analysis of current state:**

    *   The system currently relies heavily on logging to provide information about its internal operations. However, the logging output is likely detailed and technical, not necessarily geared towards a user understanding the overall progress of an improvement cycle.
    *   The main endpoint `/improve` in `src/main.py` triggers an improvement cycle but provides no immediate feedback beyond a basic status response.
    *   The `src/observability.py` module appears to be designed to track cycle phases and generate summaries, but based on the file summary, it's not currently active.

2.  **Proposed improvement:**

    *   **Integrate `src/observability.py` and enhance logging:**
        *   Activate and utilize the `Observability` class within the `SystemOrchestrator` in `src/orchestrator.py`.  This means instantiating an `Observability` object and calling its methods (e.g., `start_cycle`, `record_analysis`, etc.) at the beginning and end of each stage of the improvement cycle.
        *   Modify the logging in `src/orchestrator.py` (and potentially in the AI agent files: `src/agents/base.py`, `src/agents/founder.py`, `src/agents/developer.py`, `src/agents/code_reader.py`) to leverage the `Observability` methods to record specific events during the cycle, such as the start of the cycle, analysis phase, the title and description, the implementation plan, etc.
        *   Enhance the existing logs with more descriptive messages for the users, making it easy to follow each stage.
        *   The final log would print the summary generated by the `Observability` class.

    *   **Enhance `/improve` endpoint in `src/main.py`:**
        *   The `/improve` endpoint should return a more detailed response including a unique cycle ID (timestamp is fine), and immediately after the initial message, stream the logs to the user from the backend.

3.  **Priority level (2):**

    *   This is a high-impact improvement for usability. However, it does not directly impact the core functionality of the system. It should be moderately difficult to implement, as it involves integrating existing code, and modifying logging.

4.  **Success criteria:**

    *   Upon calling the `/improve` endpoint, the user receives a response with the cycle ID.
    *   The console output (or the output of a service monitoring tool) provides a clear, step-by-step log of the improvement cycle progress, including:
        *   Start of the cycle with a unique identifier.
        *   Summarization of code.
        *   Analysis of code.
        *   Generating of the proposal.
        *   Implementation of the proposal.
        *   Creation of the pull request.
        *   Completion of the cycle with a summary of the results.
    *   The logs include information about the cycle ID and any error messages.

5.  **Potential risks:**

    *   **Debugging:** The changes involve modifying multiple files. This may require detailed debugging if any errors occur.
    *   **Over-logging:** It's important to balance the amount of detail in the logs. Too much information might confuse the user or overwhelm the system.
    *   **Performance overhead:** Excessive logging or the integration of the `Observability` module could potentially add to the overhead of an improvement cycle. This should be tested and optimized.
    *   **Error handling**: All the components must be robust. If an error occurs within one part of the cycle, the rest of the process should not hang or crash the whole cycle, and provide an understandable error message.

Now, let's generate the requirements for the Developer AI:

**Requirements for Developer AI**

**Objective:** Integrate and Activate Observability for Enhanced Cycle Progress Tracking

**Tasks:**

1.  **Integrate `src/observability.py`:**
    *   **Action:**
        *   Import `Observability` from `src/observability.py` into `src/orchestrator.py`.
        *   Instantiate an `Observability` object at the beginning of the `run_improvement_cycle` function.
        *   Call appropriate methods of the `Observability` object (e.g., `start_cycle`, `record_analysis`, `record_proposal`, `record_implementation_plan`, `record_changes`, `end_cycle`) within the `run_improvement_cycle` function, at the beginning and end of the relevant steps.
        *   Update any `logger.info` or logging statements in `src/orchestrator.py` to reflect the appropriate stages of the improvement cycle.
        *   Ensure logging statements are added in `src/agents/base.py`, `src/agents/founder.py`, `src/agents/developer.py`, and `src/agents/code_reader.py` to record each part of their cycle.

2.  **Modify Logging:**
    *   **Action:**
        *   Enhance existing log messages (e.g., using `logger.info`) in `src/orchestrator.py` to provide more descriptive and user-friendly feedback on the improvement cycle progress. Include cycle ID in each message.
        *   Use f-strings or formatted strings for clear output in logs.
    *   **Constraints:**
        *   Do not remove essential debugging information.
        *   Balance logging verbosity; Avoid over-logging to prevent output clutter.

3.  **Update `src/main.py`:**
    *   **Action:**
        *   In the `/improve` endpoint, make sure the endpoint returns a success message including a cycle ID, so it can be used to track each cycle.

**Files to Modify:**

*   `src/orchestrator.py`
*   `src/main.py`
*   `src/agents/base.py`
*   `src/agents/founder.py`
*   `src/agents/developer.py`
*   `src/agents/code_reader.py`

**Success Criteria:**

*   The `run_improvement_cycle` function correctly utilizes `Observability` to track all steps.
*   Logs provide a clear, step-by-step progress indication to the user for the improvement cycle.
*   `logger.info` messages are comprehensive.
*   `/improve` endpoint returns success messages with the cycle ID.
*   Cycle ID is included in the logs.

