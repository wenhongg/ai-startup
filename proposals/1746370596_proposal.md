# Improvement Proposal

## Title: Add Cycle Report Viewer API Endpoint

## Description:

This pull request introduces a new API endpoint, `/cycles/{cycle_id}`, to provide users with a user-friendly way to view detailed reports about improvement cycles. The endpoint retrieves cycle data, including log messages, summaries, and links to pull requests, from the `Observability` class and log files, presenting the information in a JSON format.
This enhancement significantly improves the user experience by making it easier for users to monitor and analyze the system's self-improvement process. It facilitates debugging, allows users to understand the system's progress, and provides transparency into the actions taken during each cycle.
Potential impacts include:
- Increased complexity due to the addition of a new API endpoint and associated logic.
- Potential performance bottlenecks if log files are very large; however, this can be mitigated with caching and pagination strategies in the future.
- Security implications, as the endpoint exposes cycle information; however, authentication is out of scope for this change.
Testing will involve:
- Unit tests for the new API endpoint, including tests for successful retrieval of reports, handling of invalid cycle IDs, and proper formatting of the JSON response.
- Integration tests to ensure the endpoint correctly interacts with the `Observability` class and can retrieve log messages.
- Manual testing to verify the report's content and readability.

## Files to Change:
- src/main.py
- src/orchestrator.py
- src/observability.py
- tests/test_main.py

## Original Proposal from Founder:
Okay, I'll focus on improving the **User Experience (UX)** related to the **logging and cycle reporting** of the system, which I see as an important aspect that is missing from the system.

Here's the breakdown:

1.  **Analysis of current state:**

    *   The `Observability` class (src/observability.py) exists, suggesting a basic framework for tracking cycle progress and storing data.
    *   The system has logging enabled via the `logging` module in several files (e.g., `src/code_manager.py`, `src/main.py`, etc.)
    *   `Observability` stores information about the progress of each step.
    *   However, the current system does not have any convenient way for the user to view the logs or reports. The user will have to go to the log files manually to check them.
    *   The `src/main.py` and other files indicate that the application runs as a service. This implies that the user does not have direct access to the application's output.
    *   The system creates a summary.

2.  **Proposed improvement:**

    *   **Introduce a "Cycle Report Viewer" API endpoint.** Create a new endpoint (e.g., `/cycles/{cycle_id}`) within `src/main.py` using FastAPI.
    *   **Fetch Report Data:** When this endpoint is requested, it should:
        *   Read the cycle data from the files created by `Observability` to build a comprehensive report for a specific improvement cycle.
        *   Retrieve the log messages related to this cycle using the cycle ID.
    *   **Return Report in a User-Friendly Format:** Return the cycle report as JSON including:
        *   Cycle ID.
        *   Timestamp.
        *   Cycle summary.
        *   Log messages, with timestamps and log levels (INFO, WARNING, ERROR).
        *   Links to the pull requests created.
        *   Links to proposals and implementation plans if saved as files.

    *   **Modify SystemOrchestrator to Pass Cycle ID:** The `SystemOrchestrator` in `src/orchestrator.py` should generate a unique cycle ID at the beginning of each cycle and pass it to the `Observability` methods.
    *   **Add links in the logging messages:** Add the pull request number or URL created by `CodeManager` in the log messages to make it easy to find them.
3.  **Priority level (2):** This is a medium-priority improvement. It significantly enhances the user experience by providing easy access to cycle information but doesn't directly impact core functionality. It also provides better debugging.

4.  **Success criteria:**

    *   The new `/cycles/{cycle_id}` API endpoint successfully retrieves and returns a JSON report.
    *   The report includes a cycle ID, timestamp, log messages with level, cycle summary, and a link to the pull request.
    *   Log messages are well-formatted and easily readable.
    *   The cycle ID is consistently generated and passed through the system.

5.  **Potential risks:**

    *   **Complexity:** Implementing this adds a new component to the system (the API endpoint), which could introduce new bugs.
    *   **Performance:** Reading and processing log files for large cycles might be slow. Caching could be a useful optimization.
    *   **Security:** Exposing cycle information via an API needs to be done safely. The system would require authentication, which is not addressed here but will require careful consideration.
    *   **Changes in other modules:** Changing other modules such as `SystemOrchestrator`, and `CodeManager`, might cause the breaking of the other functionalities of the program. Careful testing is required.

Now, I'll pass on these requirements to the Developer AI.

```
## Developer AI,

I need you to implement a "Cycle Report Viewer" API endpoint to improve the user experience of our autonomous development system. This endpoint will allow users to easily access detailed reports about the system's improvement cycles.

**Tasks:**

1.  **Create API Endpoint:**

    *   Add a new GET endpoint `/cycles/{cycle_id}` to `src/main.py` using FastAPI.
    *   The `{cycle_id}` should be a unique identifier for the cycle (e.g., UUID).

2.  **Fetch Cycle Report Data:**

    *   The endpoint should read the cycle data from the files created by the `Observability` class (`src/observability.py`). The `Observability` methods (`start_cycle`, `record_analysis`, etc.) should now also receive and record the cycle ID.
    *   The endpoint should also read the log messages related to the specific cycle ID. The log files are expected to be stored in the logs directory (check `deploy.sh` to know the exact path).

3.  **Construct and Return Report (JSON):**

    *   The endpoint should return a JSON response with the following format:

    ```json
    {
        "cycle_id": "unique-cycle-id",
        "timestamp": "YYYY-MM-DDTHH:MM:SSZ",
        "cycle_summary": "Summary of the cycle's progress",
        "log_messages": [
            {
                "timestamp": "YYYY-MM-DDTHH:MM:SSZ",
                "level": "INFO|WARNING|ERROR",
                "message": "Log message text"
            }
        ],
        "pull_request_url": "URL of the created pull request",
        "proposal_file": "path/to/proposal.txt",
        "implementation_plan_file": "path/to/implementation_plan.txt"
    }
    ```

4.  **Modify `SystemOrchestrator`:**

    *   Modify the `SystemOrchestrator` in `src/orchestrator.py` to generate a unique cycle ID (e.g., using `uuid.uuid4()`) at the beginning of each improvement cycle. Pass this cycle ID to all relevant methods of the `Observability` class.

5.  **Modify logging messages:**

    *   Modify the logging messages to include links to the pull request.

**Implementation Details & Considerations:**

*   **Error Handling:** Implement proper error handling (e.g., file not found, invalid cycle ID).
*   **Logging:** Ensure sufficient logging for debugging the new endpoint.
*   **Security:** This initial implementation doesn't involve user authentication, which is a potential security concern, but should be addressed in a future iteration.
*   **Performance:** If the logs are large, consider optimizations (e.g., pagination, caching).

**Deliverables:**

*   Modified `src/main.py` with the new API endpoint.
*   Modified `src/orchestrator.py` to generate and pass the cycle ID.
*   Any necessary modifications to `src/observability.py` to store the cycle ID.
*   Thorough testing to ensure the endpoint functions correctly and returns accurate reports.
```

